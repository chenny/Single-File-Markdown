<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>åœ¨çº¿Markdownç¼–è¾‘å™¨ - å®æ—¶é¢„è§ˆ | AIé©±åŠ¨ | é”é“å’¨è¯¢</title>
    <meta name="description" content="é”é“å’¨è¯¢å‡ºå“çš„ä¸€æ¬¾å¼ºå¤§ã€å…è´¹çš„åœ¨çº¿Markdownç¼–è¾‘å™¨ã€‚æ”¯æŒå®æ—¶é¢„è§ˆã€ä»£ç é«˜äº®ã€æ•°å­¦å…¬å¼(KaTeX)ã€æµç¨‹å›¾(Mermaid)å’ŒPDFå¯¼å‡ºã€‚ä¸ºAIåä½œä¸æŠ€æœ¯æ–‡æ¡£å†™ä½œä¼˜åŒ–ï¼Œå†…å®¹æœ¬åœ°ä¿å­˜ï¼Œå®‰å…¨æ— å¿§ã€‚">
    <meta name="keywords" content="Markdownç¼–è¾‘å™¨, åœ¨çº¿Markdown, Markdownå®æ—¶é¢„è§ˆ, Markdownè½¬PDF, ä»£ç é«˜äº®, æ•°å­¦å…¬å¼, æµç¨‹å›¾, Mermaid, KaTeX, AIå†™ä½œ, æŠ€æœ¯æ–‡æ¡£, å…è´¹å·¥å…·, é”é“å’¨è¯¢">
    <meta name="author" content="é”é“å’¨è¯¢">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.8.1/mermaid.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.4/katex.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.4/katex.min.css">
    
    <link id="hljs-theme" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-light.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        /* --- æ ¸å¿ƒæ ·å¼ä¸ä¸»é¢˜ --- */
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg-color: #ffffff; --text-color: #333333; --border-color: #e0e0e0;
            --editor-bg: #fafafa; --preview-bg: #ffffff; --button-bg: #f5f5f5;
            --button-hover: #e0e0e0; --accent-color: #4CAF50; --shadow: 0 2px 4px rgba(0,0,0,0.1);
            --mark-bg: #fff1a7; --scrollbar-thumb: #c1c1c1; --scrollbar-track: #f1f1f1;
            --error-bg: #f2dede; --error-text: #a94442; --error-border: #d9534f;
        }

        .dark {
            --bg-color: #1a1a1a; --text-color: #e0e0e0; --border-color: #404040;
            --editor-bg: #2d2d2d; --preview-bg: #1e1e1e; --button-bg: #3a3a3a;
            --button-hover: #4a4a4a; --accent-color: #66BB6A; --shadow: 0 2px 4px rgba(0,0,0,0.3);
            --mark-bg: #695d00; --scrollbar-thumb: #555; --scrollbar-track: #333;
            --error-bg: #2d2020; --error-text: #ff8a80; --error-border: #ff5252;
        }

        /* --- åŸºç¡€å¸ƒå±€ --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-color); color: var(--text-color); height: 100vh;
            overflow: hidden; transition: background-color 0.3s ease, color 0.3s ease; display: flex; flex-direction: column;
        }
        .container { width: 100%; flex: 1; display: flex; flex-direction: column; overflow: hidden; }

        /* --- å·¥å…·æ  --- */
        .toolbar {
            background: var(--button-bg); border-bottom: 1px solid var(--border-color);
            padding: 8px 16px; display: flex; justify-content: space-between;
            align-items: center; box-shadow: var(--shadow); z-index: 10; flex-shrink: 0;
        }
        .toolbar-left, .toolbar-right { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
        .btn {
            background: var(--button-bg); border: 1px solid var(--border-color); color: var(--text-color);
            width: 36px; height: 36px; border-radius: 4px; cursor: pointer; font-size: 16px;
            transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; position: relative;
        }
        .btn i { font-size: 1em; line-height: 1; }
        .btn.danger { color: #f44336; }
        .btn:hover { background: var(--button-hover); transform: translateY(-1px); }
        .btn::after {
            content: attr(aria-label); position: absolute; bottom: -30px; left: 50%;
            transform: translateX(-50%); background: rgba(0,0,0,0.8); color: white;
            padding: 4px 8px; border-radius: 4px; font-size: 12px; white-space: nowrap;
            z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.2s ease, visibility 0.2s ease;
        }
        .btn:hover::after { opacity: 1; visibility: visible; }
        .btn.active { background: var(--accent-color); color: white; border-color: var(--accent-color); }

        /* --- ä¸»å†…å®¹åŒº --- */
        .main-content { flex: 1; display: flex; overflow: hidden; }
        .editor-panel {
            flex: 1; background: var(--editor-bg); border-right: 1px solid var(--border-color);
            transition: flex 0.3s ease, width 0.3s ease, opacity 0.3s ease;
            position: relative; /* ç”¨äºå®šä½æŸ¥æ‰¾æ›¿æ¢é¢æ¿ */
        }
        .preview-panel { flex: 1; background: var(--preview-bg); overflow-y: auto; }
        
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        .editor::-webkit-scrollbar, .preview-panel::-webkit-scrollbar { width: 8px; }
        .editor::-webkit-scrollbar-track, .preview-panel::-webkit-scrollbar-track { background: var(--scrollbar-track); }
        .editor::-webkit-scrollbar-thumb, .preview-panel::-webkit-scrollbar-thumb { background: var(--scrollbar-thumb); border-radius: 4px; }
        .editor::-webkit-scrollbar-thumb:hover, .preview-panel::-webkit-scrollbar-thumb:hover { background: #888; }

        .editor-panel.hidden, .preview-panel.hidden {
            flex: 0; width: 0; padding: 0; border: none; overflow: hidden; opacity: 0;
        }

        /* ç¼–è¾‘å™¨textareaæ ·å¼ */
        .editor {
            width: 100%; height: 100%; border: none; background: transparent; color: var(--text-color);
            font-family: 'Menlo', 'Consolas', 'Courier New', monospace; font-size: 14px;
            line-height: 1.6; padding: 20px; resize: none; outline: none;
            overflow-y: auto; /* æ»šåŠ¨æ¡ä¿®å¤ï¼šè®©textareaè‡ªèº«æ»šåŠ¨ */
        }
        .preview { padding: 20px; min-height: 100%; }

        /* --- æŸ¥æ‰¾ä¸æ›¿æ¢é¢æ¿ --- */
        .find-replace-panel {
            position: absolute; top: 10px; right: 10px; background: var(--editor-bg);
            border: 1px solid var(--border-color); border-radius: 6px; box-shadow: var(--shadow);
            z-index: 20; padding: 10px; display: flex; flex-direction: column; gap: 10px;
            width: 320px; transition: opacity 0.2s, transform 0.2s;
        }
        .find-replace-panel.hidden {
            opacity: 0; visibility: hidden; transform: translateY(-10px); pointer-events: none;
        }
        .find-replace-panel div { display: flex; gap: 8px; }
        .find-replace-panel input[type="text"] {
            flex-grow: 1; border: 1px solid var(--border-color); background: var(--bg-color);
            color: var(--text-color); padding: 6px 8px; border-radius: 4px; outline: none;
            font-size: 13px;
        }
        .find-replace-panel input[type="text"]:focus { border-color: var(--accent-color); }
        .find-replace-panel button {
            background: var(--button-bg); border: 1px solid var(--border-color); color: var(--text-color);
            padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 13px;
            transition: background-color 0.2s;
        }
        .find-replace-panel button:hover { background: var(--button-hover); }
        .find-replace-panel .close-btn {
            position: absolute; top: 5px; right: 8px; background: transparent; border: none;
            font-size: 20px; cursor: pointer; color: var(--text-color); opacity: 0.6;
        }
        .find-replace-panel .close-btn:hover { opacity: 1; }

        /* --- Markdownå…ƒç´ æ ·å¼ --- */
        .preview h1, .preview h2, .preview h3, .preview h4, .preview h5, .preview h6 { margin: 20px 0 10px 0; color: var(--accent-color); font-weight: 600; }
        .preview h1 { font-size: 2em; border-bottom: 2px solid var(--accent-color); padding-bottom: 10px; }
        .preview h2 { font-size: 1.5em; border-bottom: 1px solid var(--border-color); padding-bottom: 5px; }
        .preview p { margin: 10px 0; line-height: 1.6; }
        .preview a { color: var(--accent-color); text-decoration: none; border-bottom: 1px solid transparent; transition: all 0.2s ease; }
        .preview a:hover { border-bottom-color: var(--accent-color); }
        .preview code { background: var(--button-bg); padding: 2px 4px; border-radius: 3px; font-family: 'Menlo', 'Consolas', 'Courier New', monospace; font-size: 0.9em; }
        .preview pre { background: var(--button-bg); padding: 15px; border-radius: 5px; overflow-x: auto; margin: 10px 0; border-left: 4px solid var(--accent-color); position: relative; }
        .preview pre .copy-btn { position: absolute; top: 8px; right: 8px; background: var(--button-hover); color: var(--text-color); border: 1px solid var(--border-color); border-radius: 4px; padding: 4px 8px; font-size: 12px; cursor: pointer; opacity: 0; transition: opacity 0.2s ease; z-index: 1; }
        .preview pre:hover .copy-btn { opacity: 1; }
        .preview pre:hover .copy-btn:hover { background: var(--accent-color); color: white; }
        .preview pre code.hljs { background: transparent; padding: 0; }
        .preview mark { background-color: var(--mark-bg); padding: 1px 4px; border-radius: 3px; }
        .preview blockquote { border-left: 4px solid var(--accent-color); margin: 10px 0; padding: 10px 20px; background: var(--button-bg); border-radius: 0 5px 5px 0; }
        .preview ul, .preview ol { margin: 10px 0; padding-left: 30px; }
        .preview li { margin: 5px 0; }
        .preview table { border-collapse: collapse; width: 100%; margin: 10px 0; }
        .preview th, .preview td { border: 1px solid var(--border-color); padding: 8px 12px; text-align: left; }
        .preview th { background: var(--button-bg); font-weight: 600; }
        .preview img { max-width: 100%; height: auto; display: block; margin: 10px 0; }

        /* --- çŠ¶æ€æ  --- */
        .stats { padding: 8px 16px; background: var(--button-bg); border-top: 1px solid var(--border-color); font-size: 12px; color: var(--text-color); opacity: 0.8; display: flex; justify-content: space-between; flex-shrink: 0; }
        
        /* --- ç‰¹æ®Šæ¨¡å—æ ·å¼ --- */
        .mermaid, .math-block { text-align: center; margin: 20px 0; }
        .math-inline { display: inline; }
        .render-error { border: 2px solid var(--error-border); padding: 10px; color: var(--error-text); background-color: var(--error-bg); border-radius: 4px; margin: 10px 0; }
        .render-error pre { white-space: pre-wrap; color: var(--error-text); background: transparent; border: none; padding: 0; }

        /* --- é¡µè„šæ ·å¼ --- */
        footer {
            padding: 15px; text-align: center; font-size: 14px;
            color: var(--text-color); opacity: 0.6; flex-shrink: 0;
            border-top: 1px solid var(--border-color);
            background: var(--bg-color);
        }
        footer a {
            color: var(--text-color);
            text-decoration: none;
        }
        footer a:hover {
            text-decoration: underline;
        }

        /* --- ç§»åŠ¨ç«¯ä¼˜åŒ– --- */
        @media (max-width: 768px) {
            .toolbar { padding: 8px; gap: 4px; }
            .toolbar-left, .toolbar-right { gap: 4px; }
            .btn { width: 40px; height: 40px; font-size: 18px; }
            .btn::after { display: none; }
            .main-content { flex-direction: column; }
            .editor-panel, .preview-panel { border-right: none; border-bottom: 1px solid var(--border-color); flex: 1; height: auto; }
            .editor { font-size: 16px; }
            .preview { padding: 15px; }
            .stats { flex-wrap: wrap; gap: 8px; }
            .find-replace-panel { width: auto; left: 10px; right: 10px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="toolbar">
            <div class="toolbar-left">
                <button class="btn" onclick="undo()" aria-label="æ’¤é”€ (Ctrl+Z)"><i class="fa-solid fa-rotate-left"></i></button>
                <button class="btn" onclick="redo()" aria-label="é‡åš (Ctrl+Y)"><i class="fa-solid fa-rotate-right"></i></button>
                <button class="btn" onclick="insertFormat('**', '**')" aria-label="åŠ ç²— (Ctrl+B)"><i class="fa-solid fa-bold"></i></button>
                <button class="btn" onclick="insertFormat('*', '*')" aria-label="æ–œä½“ (Ctrl+I)"><i class="fa-solid fa-italic"></i></button>
                <button class="btn" onclick="insertFormat('~~', '~~')" aria-label="åˆ é™¤çº¿"><i class="fa-solid fa-strikethrough"></i></button>
                <button class="btn" onclick="insertFormat('`', '`')" aria-label="è¡Œå†…ä»£ç "><i class="fa-solid fa-code"></i></button>
                <button class="btn" onclick="insertFormat('==', '==')" aria-label="æ ‡è®°"><i class="fa-solid fa-highlighter"></i></button>
                <button class="btn" onclick="insertFormat('\n```\n', '\n```\n')" aria-label="ä»£ç å—"><i class="fa-solid fa-file-code"></i></button>
                <button class="btn" onclick="insertFormat('\n- ', '')" aria-label="åˆ—è¡¨"><i class="fa-solid fa-list-ul"></i></button>
                <button class="btn" onclick="insertFormat('\n> ', '')" aria-label="å¼•ç”¨"><i class="fa-solid fa-quote-left"></i></button>
                <button class="btn" onclick="insertFormat('\n## ', '')" aria-label="æ ‡é¢˜"><i class="fa-solid fa-heading"></i></button>
                <button class="btn" onclick="insertFormat('[', '](url)')" aria-label="é“¾æ¥"><i class="fa-solid fa-link"></i></button>
                <button class="btn" onclick="insertFormat('\n| è¡¨å¤´1 | è¡¨å¤´2 |\n|---|---|\n| å•å…ƒæ ¼1 | å•å…ƒæ ¼2 |\n', '')" aria-label="è¡¨æ ¼"><i class="fa-solid fa-table"></i></button>
                <button class="btn" onclick="insertFormat('\n```mermaid\ngraph TD;\n    A-->B;\n```\n', '')" aria-label="Mermaidå›¾è¡¨"><i class="fa-solid fa-diagram-project"></i></button>
                <button class="btn" onclick="toggleFindReplace(true)" aria-label="æŸ¥æ‰¾å’Œæ›¿æ¢ (Ctrl+F)"><i class="fa-solid fa-magnifying-glass"></i></button>
            </div>
            <div class="toolbar-right">
                
                <button class="btn" onclick="toggleView('editor')" aria-label="ä»…ç¼–è¾‘"><i class="fa-solid fa-pen-to-square"></i></button>
                <button class="btn" onclick="toggleView('preview')" aria-label="ä»…é¢„è§ˆ"><i class="fa-solid fa-eye"></i></button>
                <button class="btn" onclick="toggleView('both')" aria-label="åˆ†æ "><i class="fa-solid fa-table-columns"></i></button>
                <button class="btn" onclick="toggleTheme()" aria-label="åˆ‡æ¢ä¸»é¢˜"><i id="themeIcon" class="fa-solid fa-moon"></i></button>
                <button class="btn" onclick="toggleFullscreen()" aria-label="å…¨å± (F11)"><i id="fullscreenIcon" class="fa-solid fa-expand"></i></button>
                <button class="btn" onclick="exportMarkdown()" aria-label="å¯¼å‡ºMD"><i class="fa-solid fa-file-arrow-down"></i></button>
                <button class="btn" onclick="exportPDF()" aria-label="å¯¼å‡ºPDF"><i class="fa-solid fa-file-pdf"></i></button>
                <button class="btn danger" onclick="clearLocalStorage()" aria-label="æ¸…é™¤æœ¬åœ°ç¼“å­˜"><i class="fa-solid fa-trash-can"></i></button>
            </div>
        </div>
        
        <div class="main-content" id="mainContent">
            <div class="editor-panel" id="editorPanel">
                <textarea class="editor" id="editor" placeholder="åœ¨æ­¤è¾“å…¥Markdownå†…å®¹..." spellcheck="false"></textarea>
                <div class="find-replace-panel hidden" id="findReplacePanel">
                    <button class="close-btn" onclick="toggleFindReplace(false)" aria-label="å…³é—­">&times;</button>
                    <div>
                        <input type="text" id="findInput" placeholder="æŸ¥æ‰¾...">
                        <button onclick="findNext()">ä¸‹ä¸€ä¸ª</button>
                    </div>
                    <div>
                        <input type="text" id="replaceInput" placeholder="æ›¿æ¢ä¸º...">
                        <button onclick="replaceNext()">æ›¿æ¢</button>
                        <button onclick="replaceAll()">å…¨éƒ¨</button>
                    </div>
                </div>
            </div>
            <div class="preview-panel" id="previewPanel">
                <div class="preview" id="preview"></div>
            </div>
        </div>
        
        <div class="stats">
            <span>ç¼–è¾‘å™¨: <span id="editorChars">0</span> å­—ç¬¦</span>
            <span>é¢„è§ˆ: <span id="previewWords">0</span> å­—</span>
            <span id="currentTime"></span>
        </div>
    </div>
    
    <footer>
        <p>&copy; 2010-2025 é”é“å’¨è¯¢  | <a href="https://beian.miit.gov.cn/" target="_blank">æ²ªICPå¤‡11000302å·</a></p>
    </footer>

    <script>
        (function() {
            // --- DOM å…ƒç´ ç¼“å­˜ ---
            const dom = {
                editor: document.getElementById('editor'),
                preview: document.getElementById('preview'),
                editorPanel: document.getElementById('editorPanel'),
                previewPanel: document.getElementById('previewPanel'),
                themeIcon: document.getElementById('themeIcon'),
                fullscreenIcon: document.getElementById('fullscreenIcon'),
                editorChars: document.getElementById('editorChars'),
                previewWords: document.getElementById('previewWords'),
                currentTime: document.getElementById('currentTime'),
                hljsTheme: document.getElementById('hljs-theme'),
                findReplacePanel: document.getElementById('findReplacePanel'),
                findInput: document.getElementById('findInput'),
                replaceInput: document.getElementById('replaceInput'),
            };

            // --- åº”ç”¨çŠ¶æ€ ---
            const state = {
                history: [], historyIndex: -1, isDark: false, isSyncing: false,
                debounceTimer: null, currentView: 'both',
                lastSearch: { query: '', index: -1 }
            };

            // --- å¸¸é‡ ---
            const DEBOUNCE_TIMEOUT = 250;
            const HISTORY_LIMIT = 50;
            const INITIAL_CONTENT = `# æ¬¢è¿ä½¿ç”¨ AI é©±åŠ¨çš„ Markdown ç¼–è¾‘å™¨

## ğŸš€ AI æ—¶ä»£çš„ Markdown
åœ¨ç”Ÿæˆå¼AIé‡å¡‘åˆ›ä½œæ–¹å¼çš„ä»Šå¤©ï¼ŒMarkdownæ­£æˆä¸ºäººæœºåä½œçš„æœ€ä½³äº¤äº’è¯­è¨€ï¼š
- **AIåŸç”Ÿæ ¼å¼**ï¼šChatGPTç­‰å¤§æ¨¡å‹åŸç”Ÿæ”¯æŒMarkdownè¾“å‡º
- **æ¨¡å—åŒ–åˆ›ä½œ**ï¼šç”¨Markdownç»„ç»‡æ€è·¯ï¼ŒAIè¾…åŠ©å¡«å……å†…å®¹ç»†èŠ‚
- **åŒå‘å¢å¼º**ï¼šAIç”Ÿæˆçš„å†…å®¹å¯ç›´æ¥å¯¼å…¥ç¼–è¾‘ï¼Œä¿®æ”¹åå†æ¬¡ä¼˜åŒ–
- **ä»£ç å³æ–‡æ¡£**ï¼šå¼€å‘è€…å¯åœ¨Markdownä¸­åµŒå…¥å¯æ‰§è¡Œä»£ç ç‰‡æ®µ
- **çŸ¥è¯†ç½‘ç»œ**ï¼šé€šè¿‡Markdownæ„å»ºä¸ªäººçŸ¥è¯†åº“ï¼Œä¸AIå½¢æˆçŸ¥è¯†é—­ç¯

---

## âœ¨ åŠŸèƒ½äº®ç‚¹
* **å•æ–‡ä»¶HTML**: åªæœ‰ä¸€ä¸ªç®€å•HTMLæ–‡ä»¶ï¼Œå³ä½¿æ–­ç½‘ä¹Ÿèƒ½éšæ—¶ä½¿ç”¨ã€‚
* **æ— ä»»ä½•å¹¿å‘Š**: ä¸ä¼šæœ‰ä»»ä½•å¹¿å‘Šå¹²æ‰°ä½ çš„ä½¿ç”¨ä½“éªŒã€‚
* **æ™ºèƒ½åŒæ­¥æ»šåŠ¨**: ç¼–è¾‘åŒºä¸é¢„è§ˆåŒºæ— ç¼åŒæ­¥ï¼Œè®©æ‚¨çš„è§†çº¿å§‹ç»ˆèšç„¦ã€‚
* **å®æ—¶é¢„è§ˆ**: \`marked.js\` å¼ºåŠ›é©±åŠ¨ï¼Œå³æ—¶æ¸²æŸ“æ‚¨çš„æ¯ä¸€å¤„æ›´æ”¹ã€‚
* **ä»£ç é«˜äº®**: \`highlight.js\` æ”¯æŒä¸Šç™¾ç§è¯­è¨€ï¼Œè®©æ‚¨çš„ä»£ç å—æ¸…æ™°æ˜“è¯»ã€‚
* **æ•°å­¦å…¬å¼**: æ”¯æŒ \`KaTeX\`ï¼Œæ— è®ºæ˜¯è¡Œå†…å…¬å¼ $E=mc^2$ è¿˜æ˜¯å¤æ‚çš„æ•°å­¦å—ï¼Œéƒ½èƒ½è½»æ¾æå®šã€‚
* **æµç¨‹å›¾è¡¨**: å†…ç½® \`Mermaid\` æ”¯æŒï¼Œç”¨ç®€å•çš„æ–‡æœ¬ç»˜åˆ¶å¤æ‚çš„å›¾è¡¨ã€‚
* **æŸ¥æ‰¾æ›¿æ¢**: å¼ºå¤§çš„ \`Ctrl+F\` åŠŸèƒ½ï¼Œå¿«é€Ÿå®šä½å’Œä¿®æ”¹å†…å®¹ã€‚
* **ä¸»é¢˜åˆ‡æ¢**: å†…ç½®æ˜æš—ä¸¤ç§ä¸»é¢˜ï¼Œå¹¶å¯æ ¹æ®ç³»ç»Ÿæ—¶é—´è‡ªåŠ¨åˆ‡æ¢ï¼Œå‘µæŠ¤æ‚¨çš„åŒçœ¼ã€‚
* **æœ¬åœ°å­˜å‚¨**: å†…å®¹è‡ªåŠ¨ä¿å­˜åœ¨æµè§ˆå™¨ä¸­ï¼Œåˆ·æ–°é¡µé¢ä¹Ÿä¸æ€•ä¸¢å¤±ã€‚

---

## ğŸ”¥ ä¸ºä»€ä¹ˆé€‰æ‹© Markdown
åœ¨ä¿¡æ¯çˆ†ç‚¸çš„æ—¶ä»£ï¼ŒMarkdown å‡­å€Ÿå…¶æç®€è¯­æ³•å’Œå¼ºå¤§è¡¨ç°åŠ›ï¼Œå·²æˆä¸ºå…¨çƒåˆ›ä½œè€…çš„é¦–é€‰å†™ä½œè¯­è¨€ï¼š
1. **ä¸“æ³¨å†…å®¹**ï¼šçº¯æ–‡æœ¬æ ¼å¼è®©ä½ æ‘†è„±æ’ç‰ˆå¹²æ‰°ï¼Œä¸“æ³¨äºæ€æƒ³è¡¨è¾¾
2. **ç»ˆèº«ä¿å­˜**ï¼šæ²¡æœ‰ç‰ˆæœ¬å…¼å®¹é—®é¢˜ï¼Œ10å¹´åä»å¯è½»æ¾æ‰“å¼€ç¼–è¾‘
3. **å¤šå¹³å°å‘å¸ƒ**ï¼šä¸€é”®å¯¼å‡ºHTMLã€PDFã€Wordç­‰å¤šç§æ ¼å¼
4. **å¼€å‘è€…æœ€çˆ±**ï¼šGitHubã€GitLabç­‰ä»£ç å¹³å°åŸç”Ÿæ”¯æŒ
5. **é«˜æ•ˆåä½œ**ï¼šè½»é‡åŒ–æ–‡ä»¶ä¾¿äºå›¢é˜Ÿå…±äº«å’Œç‰ˆæœ¬æ§åˆ¶

---

## markdownè¯­æ³•ç¤ºä¾‹

### æ–‡æœ¬æ ¼å¼

**è¿™æ˜¯åŠ ç²—çš„æ–‡å­—**

*è¿™æ˜¯æ–œä½“çš„æ–‡å­—*

~~è¿™æ˜¯å¸¦åˆ é™¤çº¿çš„æ–‡å­—~~

==è¿™æ˜¯é«˜äº®æ ‡è®°çš„æ–‡å­—==

> è¿™æ˜¯ä¸€ä¸ªå¼•ç”¨å—ã€‚
> â€”â€” AI

### åˆ—è¡¨

**æ— åºåˆ—è¡¨**
- è‹¹æœ
- é¦™è•‰
  - é»„é¦™è•‰
- æ©™å­

**æœ‰åºåˆ—è¡¨**
1. ç¬¬ä¸€æ­¥
2. ç¬¬äºŒæ­¥
3. ç¬¬ä¸‰æ­¥

**ä»»åŠ¡åˆ—è¡¨**
- [x] å®Œæˆ å…³æ³¨é”é“å’¨è¯¢å…¬ä¼—å·
- [ ] åŠ å…¥è…¾è®¯ ima çŸ¥è¯†åº“ [é“¶è¡Œä¸šç²¾å“çŸ¥è¯†åº“](https://ima.qq.com/wiki/?shareId=ba3a965538b9456d653f5e6d2f25d5620bbab2a5637c68a62419ad65e172e1c4)

### ä»£ç å—

\`\`\`javascript
// JavaScript ç¤ºä¾‹
function hello(name) {
  console.log(\`æ¬¢è¿åŠ å…¥, \${name}!\`);
}

hello('é“¶è¡ŒäººçŸ¥è¯†åº“');
\`\`\`

### è¡¨æ ¼

| å§“å   | èŒä¸š         | è´¡çŒ®          |
| ------ | ------------ | ------------- |
| å°å¹³ | ç§‘æŠ€éƒ¨ | æ„å»ºæ­¤ç¼–è¾‘å™¨  |
| é”é“   | åˆ›ä½œè€…       | èµ‹äºˆå†…å®¹çµé­‚  |

### æ•°å­¦å…¬å¼ (LaTeX)

å—çº§å…¬å¼:
$$
\\int_a^b f(x)dx = F(b) - F(a)
$$

### å›¾è¡¨ (Mermaid)

\`\`\`mermaid
graph TD;
    A[å¼€å§‹] --> B{æ£€æŸ¥éœ€æ±‚};
    B -->|éœ€æ±‚æ˜ç¡®| C[ç¼–å†™ä»£ç ];
    B -->|éœ€æ±‚æ¨¡ç³Š| D[ä¸ç”¨æˆ·æ²Ÿé€š];
    C --> E[å®ŒæˆåŠŸèƒ½];
    D --> B;
\`\`\`

å¸Œæœ›æ‚¨äº«å—è¿™æ¬¡ç”± AI å¸¦æ¥çš„ä¹¦å†™ä½“éªŒï¼`;

            // --- Marked.js è‡ªå®šä¹‰ ---
            function setupMarked() {
                const renderer = new marked.Renderer();
                renderer.image = (href, title, text) => {
                    const match = href ? href.match(/^(.*?)\s*=(\d*)x?(\d*)$/) : null;
                    let url = href, style = '';
                    if (match) {
                        url = match[1].trim();
                        if (match[2]) style += `width: ${match[2]}px;`;
                        if (match[3]) style += `height: ${match[3]}px;`;
                    }
                    return `<img src="${url}" alt="${text}" title="${title || ''}" style="${style}">`;
                };
                
                // Bug ä¿®å¤ï¼šç§»é™¤äº†ä¸ GFM å†²çªçš„è‡ªå®šä¹‰ listitem æ¸²æŸ“å™¨ã€‚
                // marked.js çš„ gfm:true é€‰é¡¹ä¼šè‡ªåŠ¨å¤„ç†ä»»åŠ¡åˆ—è¡¨ã€‚
                
                const markExtension = {
                    name: 'mark', level: 'inline', start(src) { return src.indexOf('=='); },
                    tokenizer(src) {
                        const match = /^==([^=]+)==/.exec(src);
                        if (match) return { type: 'mark', raw: match[0], text: this.lexer.inlineTokens(match[1].trim()) };
                    },
                    renderer(token) { return `<mark>${this.parser.parseInline(token.text)}</mark>`; }
                };
                marked.use({ renderer, extensions: [markExtension], gfm: true });
            }

            // --- åˆå§‹åŒ– ---
            function init() {
                setupMarked();
                setupEventListeners();
                loadFromLocalStorage();
                autoThemeSwitch();
                updateAll();
                updateTime();
                toggleView(window.innerWidth <= 768 ? 'editor' : 'both');
                saveToHistory(dom.editor.value);
            }

            function setupEventListeners() {
                dom.editor.addEventListener('input', handleEditorInput);
                dom.editor.addEventListener('keydown', handleShortcuts);
                document.addEventListener('keydown', handleGlobalShortcuts);
                dom.editor.addEventListener('scroll', handleScrollSync);
                dom.previewPanel.addEventListener('scroll', handleScrollSync);
                document.addEventListener('fullscreenchange', updateFullscreenIcon);
                setInterval(updateTime, 1000);
                setInterval(autoThemeSwitch, 60000);
            }

            // --- æ ¸å¿ƒæ›´æ–°ä¸æ¸²æŸ“ ---
            function updateAll() {
                const content = dom.editor.value;
                dom.preview.innerHTML = marked.parse(processLatex(content));
                processHighlighting();
                processMermaid();
                addCopyToCodeBlocks();
                updateStats();
            }

            function processLatex(content) {
                const render = (formula, displayMode) => {
                    try { return katex.renderToString(formula.trim(), { displayMode, throwOnError: false }); } 
                    catch (e) { return `<span class="render-error" title="${e.message}">LaTeXé”™è¯¯</span>`; }
                };
                let processed = content.replace(/\$\$([\s\S]*?)\$\$/g, (_, f) => `<div class="math-block">${render(f, true)}</div>`);
                return processed.replace(/\$((?!\s)[\s\S]*?[^\s])\$/g, (m, f) => f.includes('$') ? m : `<span class="math-inline">${render(f, false)}</span>`);
            }

            function processHighlighting() { try { dom.preview.querySelectorAll('pre code:not(.language-mermaid)').forEach(hljs.highlightElement); } catch(e) { console.warn('Highlight.js å¤±è´¥:', e); } }
            
            function processMermaid() {
                try {
                    mermaid.initialize({ startOnLoad: false, theme: state.isDark ? 'dark' : 'default', securityLevel: 'loose' });
                    dom.preview.querySelectorAll('code.language-mermaid').forEach((block, index) => {
                        const wrapper = document.createElement('div');
                        wrapper.className = 'mermaid';
                        wrapper.id = `mermaid-${Date.now()}-${index}`;
                        wrapper.textContent = block.textContent;
                        block.parentNode.parentNode.replaceChild(wrapper, block.parentNode);
                        mermaid.run({ nodes: [wrapper] }).catch(err => {
                            wrapper.innerHTML = `<div class="render-error"><strong>Mermaidæ¸²æŸ“å¤±è´¥:</strong><br><pre>${err.message}</pre></div>`;
                        });
                    });
                } catch (e) { console.warn('Mermaid å¤„ç†å¤±è´¥:', e); }
            }

            function addCopyToCodeBlocks() {
                dom.preview.querySelectorAll('pre:not(:has(.copy-btn))').forEach(pre => {
                    if (pre.querySelector('code.language-mermaid')) return;
                    const button = document.createElement('button');
                    button.className = 'copy-btn';
                    button.textContent = 'Copy';
                    button.setAttribute('aria-label', 'å¤åˆ¶åˆ°å‰ªè´´æ¿');
                    button.onclick = async () => {
                        const code = pre.querySelector('code').innerText;
                        try {
                            await navigator.clipboard.writeText(code);
                            button.textContent = 'Copied!';
                        } catch (err) { button.textContent = 'Error'; }
                        setTimeout(() => { button.textContent = 'Copy'; }, 2000);
                    };
                    pre.appendChild(button);
                });
            }

            function updateStats() {
                dom.editorChars.textContent = dom.editor.value.length;
                const words = (dom.preview.innerText || '').match(/[\u4e00-\u9fa5]|[a-zA-Z0-9_]+/g) || [];
                dom.previewWords.textContent = words.length;
            }

            function updateTime() { dom.currentTime.textContent = new Date().toLocaleTimeString('zh-CN'); }

            // --- äº‹ä»¶å¤„ç†å™¨ ---
            function handleEditorInput() {
                clearTimeout(state.debounceTimer);
                state.debounceTimer = setTimeout(() => {
                    state.lastSearch.index = -1; // æ–‡æœ¬å·²æ›´æ”¹ï¼Œé‡ç½®æœç´¢
                    updateAll();
                    saveToLocalStorage();
                    saveToHistory(dom.editor.value);
                }, DEBOUNCE_TIMEOUT);
            }

            function handleShortcuts(e) {
                if (e.ctrlKey || e.metaKey) {
                    let handled = true;
                    switch (e.key.toLowerCase()) {
                        case 'f': toggleFindReplace(true); break;
                        case 'z': undo(); break;
                        case 'y': redo(); break;
                        case 'b': insertFormat('**', '**'); break;
                        case 'i': insertFormat('*', '*'); break;
                        default: handled = false;
                    }
                    if (handled) e.preventDefault();
                }
            }
            
            function handleGlobalShortcuts(e) { if (e.key === 'F11') { e.preventDefault(); toggleFullscreen(); } }

            function handleScrollSync(e) {
                if (state.isSyncing) return;
                state.isSyncing = true;

                const source = e.currentTarget;
                const target = source === dom.editor ? dom.previewPanel : dom.editor;

                if (source.scrollHeight <= source.clientHeight) {
                    requestAnimationFrame(() => { state.isSyncing = false; });
                    return;
                }
                const scrollRatio = source.scrollTop / (source.scrollHeight - source.clientHeight);
                target.scrollTop = scrollRatio * (target.scrollHeight - target.clientHeight);
                
                requestAnimationFrame(() => { state.isSyncing = false; });
            }

            // --- åŠŸèƒ½å‡½æ•° ---
            function saveToLocalStorage() { try { localStorage.setItem('markdownContent', dom.editor.value); } catch (e) { console.error("æ— æ³•ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨:", e); } }
            function loadFromLocalStorage() { dom.editor.value = localStorage.getItem('markdownContent') || INITIAL_CONTENT; }
            function clearLocalStorage() {
                if (confirm('æ‚¨ç¡®å®šè¦æ¸…é™¤æœ¬åœ°ç¼“å­˜å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ¢å¤ã€‚')) {
                    localStorage.removeItem('markdownContent');
                    dom.editor.value = '';
                    updateAll();
                    saveToHistory('');
                }
            }
            function autoThemeSwitch() {
                const hour = new Date().getHours();
                if (document.body.classList.contains('dark') !== (hour >= 19 || hour < 6)) toggleTheme();
            }

            function saveToHistory(content) {
                if (state.historyIndex < state.history.length - 1) state.history = state.history.slice(0, state.historyIndex + 1);
                if (state.history[state.history.length - 1] !== content) {
                    state.history.push(content);
                    state.historyIndex++;
                }
                if (state.history.length > HISTORY_LIMIT) { state.history.shift(); state.historyIndex--; }
            }
            function undo() { if (state.historyIndex > 0) { state.historyIndex--; dom.editor.value = state.history[state.historyIndex]; updateAll(); } }
            function redo() { if (state.historyIndex < state.history.length - 1) { state.historyIndex++; dom.editor.value = state.history[state.historyIndex]; updateAll(); } }

            function insertFormat(before, after) {
                const { scrollTop, selectionStart: start, selectionEnd: end } = dom.editor;
                const selectedText = dom.editor.value.substring(start, end);
                const newText = before + selectedText + after;
                dom.editor.value = dom.editor.value.substring(0, start) + newText + dom.editor.value.substring(end);
                dom.editor.focus();
                const newPos = start + before.length;
                dom.editor.setSelectionRange(newPos, newPos + selectedText.length);
                dom.editor.scrollTop = scrollTop;
                handleEditorInput();
            }

            function toggleView(view) {
                state.currentView = view;
                document.querySelectorAll('.toolbar-right .btn.active').forEach(b => b.classList.remove('active'));
                const targetBtn = document.querySelector(`button[onclick="toggleView('${view}')"]`);
                if (targetBtn) targetBtn.classList.add('active');
                
                const wasPreviewHidden = dom.previewPanel.classList.contains('hidden');
                dom.editorPanel.classList.toggle('hidden', view === 'preview');
                dom.previewPanel.classList.toggle('hidden', view === 'editor');
                if (wasPreviewHidden && (view === 'preview' || view === 'both')) updateAll();
            }

            function toggleTheme() {
                state.isDark = !state.isDark;
                document.body.classList.toggle('dark', state.isDark);
                dom.themeIcon.classList.toggle('fa-sun', state.isDark);
                dom.themeIcon.classList.toggle('fa-moon', !state.isDark);
                dom.themeIcon.parentNode.setAttribute('aria-label', state.isDark ? 'æ˜äº®ä¸»é¢˜' : 'æš—é»‘ä¸»é¢˜');
                dom.hljsTheme.href = `https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-${state.isDark ? 'dark' : 'light'}.min.css`;
                updateAll();
            }

            function toggleFullscreen() {
                if (!document.fullscreenElement) document.documentElement.requestFullscreen().catch(err => console.error(`å…¨å±å¤±è´¥: ${err.message}`));
                else document.exitFullscreen();
            }
            function updateFullscreenIcon() {
                const isFullscreen = !!document.fullscreenElement;
                dom.fullscreenIcon.classList.toggle('fa-compress', isFullscreen);
                dom.fullscreenIcon.classList.toggle('fa-expand', !isFullscreen);
                dom.fullscreenIcon.parentNode.setAttribute('aria-label', isFullscreen ? 'é€€å‡ºå…¨å±' : 'å…¨å± (F11)');
            }

            function exportMarkdown() {
                const blob = new Blob([dom.editor.value], { type: 'text/markdown;charset=utf-8' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = 'document.md';
                a.click();
                URL.revokeObjectURL(a.href);
            }
            function exportPDF() {
                const opt = { margin: 0.5, filename: 'document.pdf', image: { type: 'jpeg', quality: 0.98 }, html2canvas: { scale: 2, useCORS: true }, jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' } };
                const originalOverflow = dom.previewPanel.style.overflowY;
                dom.previewPanel.style.overflowY = 'visible';
                html2pdf().set(opt).from(dom.preview).save().then(() => { dom.previewPanel.style.overflowY = originalOverflow; }).catch(err => { console.error("PDFå¯¼å‡ºå¤±è´¥:", err); dom.previewPanel.style.overflowY = originalOverflow; });
            }

            // --- æ–°å¢ï¼šæŸ¥æ‰¾ä¸æ›¿æ¢åŠŸèƒ½ ---
            function toggleFindReplace(show) {
                dom.findReplacePanel.classList.toggle('hidden', !show);
                if (show) {
                    dom.findInput.focus();
                    dom.findInput.select();
                }
            }

            function findNext() {
                const query = dom.findInput.value;
                if (!query) return;

                const text = dom.editor.value;
                let startIndex = dom.editor.selectionEnd;
                
                if (state.lastSearch.query !== query || state.lastSearch.index === -1) {
                    state.lastSearch.query = query;
                } else {
                    startIndex = state.lastSearch.index + 1;
                }

                let index = text.indexOf(query, startIndex);
                if (index === -1) {
                    index = text.indexOf(query, 0);
                }

                if (index > -1) {
                    dom.editor.focus();
                    dom.editor.setSelectionRange(index, index + query.length);
                    state.lastSearch.index = index;
                } else {
                    state.lastSearch.index = -1;
                    alert(`æœªæ‰¾åˆ° "${query}"`);
                }
            }

            function replaceNext() {
                const findQuery = dom.findInput.value;
                const replaceQuery = dom.replaceInput.value;
                if (!findQuery) return;

                const { selectionStart, selectionEnd } = dom.editor;
                const selectedText = dom.editor.value.substring(selectionStart, selectionEnd);

                if (selectedText.toLowerCase() === findQuery.toLowerCase()) {
                    const before = dom.editor.value.substring(0, selectionStart);
                    const after = dom.editor.value.substring(selectionEnd);
                    dom.editor.value = before + replaceQuery + after;
                    
                    dom.editor.selectionStart = selectionStart;
                    dom.editor.selectionEnd = selectionStart + replaceQuery.length;
                    handleEditorInput();
                }
                findNext();
            }

            function replaceAll() {
                const findQuery = dom.findInput.value;
                const replaceQuery = dom.replaceInput.value;
                if (!findQuery) return;

                const originalValue = dom.editor.value;
                const newValue = originalValue.replaceAll(findQuery, replaceQuery);

                if (originalValue !== newValue) {
                    dom.editor.value = newValue;
                    handleEditorInput();
                }
            }

            // --- å°†å‡½æ•°æš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸ ---
            Object.assign(window, {
                undo, redo, insertFormat, toggleView, toggleTheme, toggleFullscreen,
                exportMarkdown, exportPDF, clearLocalStorage,
                toggleFindReplace, findNext, replaceNext, replaceAll
            });

            // --- å¯åŠ¨åº”ç”¨ ---
            document.addEventListener('DOMContentLoaded', init);
        })();
    </script>
</body>
</html>
